# 基于FreeRTOS的双人贪吃蛇游戏

## 项目概述

这是一个基于STM32F103T8C6的双人贪吃蛇游戏，使用FreeRTOS实时操作系统，支持两个MPU6050陀螺仪作为游戏控制器。

## 硬件配置

- **主控芯片**: STM32F103T8C6
- **显示屏**: ST7735S (160x128像素)
- **传感器**: 2个MPU6050陀螺仪 (I2C通信)
- **通信**: USART串口调试

## 游戏特性

- 双人对战贪吃蛇游戏
- 陀螺仪倾斜控制蛇的移动方向
- 纯色色块显示，头身一致
- 实时分数显示
- 碰撞检测和游戏结束判断

## 项目结构

```
Game/
├── snake.h              # 贪吃蛇游戏核心头文件
├── snake.c              # 贪吃蛇游戏核心逻辑
├── snake_tasks.c        # FreeRTOS任务实现
├── snake_config.h       # 游戏配置文件
├── mpu6050_adapter.c    # MPU6050适配器(测试用)
└── (其他清理后的文件)

core/
└── main.c               # 主程序入口
```

## 游戏规则

1. **玩家1**: 红色蛇，使用第一个MPU6050控制器
2. **玩家2**: 蓝色蛇，使用第二个MPU6050控制器
3. **食物**: 绿色方块，吃到后蛇身增长，分数+10
4. **获胜条件**: 对手撞墙、撞自己或撞到己方蛇身
5. **控制方式**: 倾斜MPU6050改变蛇的移动方向

## 技术实现

### FreeRTOS任务架构

1. **MPU6050任务** (优先级3-高)
   - 读取两个陀螺仪数据
   - 方向判断和输入处理
   - 20Hz采样频率

2. **游戏逻辑任务** (优先级2-中)
   - 蛇移动逻辑
   - 碰撞检测
   - 分数计算
   - 5Hz更新频率

3. **显示任务** (优先级1-低)
   - 游戏画面绘制
   - 分数显示
   - 游戏状态显示

### 游戏配置

- **游戏区域**: 20x16格子 (每格8像素)
- **蛇初始长度**: 3节
- **倾斜阈值**: 4000 (加速度计数值)
- **游戏速度**: 200ms/帧

## 编译和使用

### 编译要求

1. 确保包含所有必要的驱动文件:
   - ST7735显示驱动
   - MPU6050传感器驱动
   - FreeRTOS内核文件

2. 在项目中包含以下文件:
   ```c
   // 必要的游戏文件
   Game/snake.c
   Game/snake_tasks.c
   Game/mpu6050_adapter.c  // 测试用
   ```

### 使用步骤

1. **硬件连接**:
   - 连接ST7735显示屏到SPI接口
   - 连接两个MPU6050到I2C接口 (地址0x68和0x69)
   - 连接串口用于调试输出

2. **软件配置**:
   - 根据实际MPU6050驱动修改`mpu6050_adapter.c`
   - 调整`snake_config.h`中的游戏参数

3. **运行游戏**:
   - 编译并下载到STM32
   - 通过串口查看调试信息
   - 倾斜MPU6050控制蛇的移动

## 调试模式

项目包含测试模式，可以在没有真实MPU6050的情况下运行:

```c
// 在snake_config.h中设置
#define SNAKE_USE_TEST_INPUT    1  // 启用测试输入
```

测试模式下，蛇会自动按预设模式移动，便于调试游戏逻辑。

## 自定义配置

可以通过修改`snake_config.h`调整游戏参数:

- 游戏速度
- 任务优先级
- 显示选项
- 调试模式

## 故障排除

1. **编译错误**: 检查头文件路径和驱动函数名称
2. **显示异常**: 确认ST7735驱动函数正确
3. **控制无响应**: 检查MPU6050连接和I2C通信
4. **游戏卡死**: 通过串口查看FreeRTOS任务状态

## 扩展功能

可以考虑添加的功能:
- 音效支持
- 更多游戏模式
- 网络对战
- 游戏记录保存

---

**注意**: 这是从坦克游戏项目改造而来的贪吃蛇游戏，部分驱动函数可能需要根据实际硬件环境进行调整。
